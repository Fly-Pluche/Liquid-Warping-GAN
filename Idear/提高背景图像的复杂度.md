

# 思想

<img src="C:\Users\BlackFriday\AppData\Roaming\Typora\typora-user-images\image-20210803153537362.png" alt="image-20210803153537362" style="zoom:50%;" />

任谁看到这么模糊的背景都会想着提升效果。。。



# 提高背景复杂度

*V1：*输入两次恢复网络，第二次用腐蚀处理

<img src="C:\Users\BlackFriday\AppData\Roaming\Typora\typora-user-images\image-20210803153537362.png" alt="image-20210803153537362" style="zoom:50%;" />

<img src="C:\Users\BlackFriday\AppData\Roaming\Typora\typora-user-images\image-20210803211630734.png" alt="image-20210803211630734" style="zoom: 33%;" /><img src="C:\Users\BlackFriday\AppData\Roaming\Typora\typora-user-images\image-20210803211643953.png" alt="image-20210803211643953" style="zoom: 33%;" /><img src="C:\Users\BlackFriday\AppData\Roaming\Typora\typora-user-images\image-20210803212729284.png" alt="image-20210803212729284" style="zoom: 33%;" />

当然，也做了不同的腐蚀次数已经多次使用恢复网络的处理，这里就不一一体现

我开始怀疑网络的性能。

看这篇Gan里面，提到过自己练了这个背景恢复网络。

```python
src_info['bg'] = self.bgnet(img, masks=body_mask, only_x=True)

body_mask=body_mask*255
body_mask=np.array(body_mask.cpu())
body_mask=body_mask.squeeze(0).squeeze(0)
body_mask = cv2.erode(body_mask, None, iterations=7)
a=cv2.erode(body_mask, None, iterations=5)
a=a.astype(np.uint8)
cv2.imwrite('腐蚀1.png',a)

body_mask=torch.from_numpy(body_mask/255)
body_mask=body_mask.unsqueeze(0).unsqueeze(0).cuda()
src_info['bg'] = self.bgnet(src_info['bg'], masks=body_mask,only_x=True)

body_mask=body_mask*255
body_mask=np.array(body_mask.cpu())
body_mask=body_mask.squeeze(0).squeeze(0)
body_mask = cv2.erode(body_mask, None, iterations=7)
a=cv2.erode(body_mask, None, iterations=5)
a=a.astype(np.uint8)
cv2.imwrite('腐蚀2.png',a)

body_mask=torch.from_numpy(body_mask/255)
body_mask=body_mask.unsqueeze(0).unsqueeze(0).cuda()
src_info['bg'] = self.bgnet(src_info['bg'], masks=body_mask,only_x=True)
```



*V2:*将图片裁剪成四块，分别输入，然后拼合

我看恢复网络论文中效果挺好的。可能是人在图片中占有的比例太大了。

*V3:*

改进网络

*V4：*输入用U2GE-net扣后的背景图，空白处比较少

*V5：*

自己搞数据集，重新练。

*V6:*

换网络

*V7:*用超分辨率





# 修改背景

<kbd>D:\workspace\impersonator-master\models\imitator.py</kbd>

128行，src_info['bg']

368行，pred_imgs

226 inference_by_smpls

203 forworad

189 inference

​			inference_by_smpls

​			self.transfer_params_by_smpl

​			self.forward

